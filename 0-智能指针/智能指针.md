# 智能指针

## 内存泄漏

- 动态申请堆空间，用完后不归还
- C++没有垃圾回收机制
- 指针无法控制所指向的堆空间的生命周期

## 当代C++软件平台的智能指针

- 指针生命周期结束的时候手动释放堆空间
- 一片堆空间最多只能有一个指针标识
- 杜绝指针运算和指针比较

## 智能指针的设计方案

- 通过模板描述指针的行为
  - 能够定义不同类型的指针对象
- 重载指针特征操作符(* 和 ->)
  - 利用对象实现原生指针的行为

## SharedPointer设计要点

- 类模板
- 通过计数机制标识堆内存
- 堆内存被指向时:ref++
- 指针被置空时:ref--
- ref == 0 时:堆内存释放

## 智能指针使用规定

- 智能指针只能指向堆空间中的对象
- 不同类型的智能指针不能混用（SmartPointer和SharedPointer）
- 不能使用delete释放被智能指针指向的堆空间